import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.BVOCwoKb.js";import{m as b}from"./marked.esm.CZd74qPG.js";function j({articleTitle:d}){const[a,l]=r.useState({author:"",text:"",articleTitle:d}),[m,i]=r.useState(!1),[c,o]=r.useState(""),[u,p]=r.useState({author:"",text:"",articleTitle:""});async function x(){const s=await(await fetch("https://myblogvalue-production.up.railway.app/comments",{method:"GET",headers:{"Content-Type":"application/json"}})).json();p(s.comments.filter(n=>n.articleTitle===d))}r.useEffect(()=>{x()},[]);const h=async t=>{if(t.preventDefault(),!a.author.trim()||!a.text.trim()){o("请填写昵称和评论内容");return}i(!0);try{const n=await(await fetch("https://myblogvalue-production.up.railway.app/comments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).json();n.success?(o("评论已提交，审核后将显示"),l({...a,author:"",text:""})):o(`提交失败: ${n.message}`)}catch{o("提交评论时发生错误，请稍后再试")}finally{i(!1)}x()};return e.jsxs("section",{className:"comment-section my-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"评论"}),u.length>0?e.jsx("div",{className:"space-y-4 mb-6",children:u.map((t,s)=>e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-semibold",children:t.author}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("time",{children:new Date(t.date).toLocaleDateString()})]}),e.jsx("p",{className:"text-gray-800 dark:text-gray-200",dangerouslySetInnerHTML:{__html:b(t.text)}})]},s))}):e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"还没有评论。成为第一个评论的人吧！"}),e.jsxs("form",{onSubmit:h,className:"space-y-4 mt-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"author",className:"block text-sm font-medium mb-1",children:"昵称"}),e.jsx("input",{type:"text",id:"author",value:a.author,onChange:t=>l({...a,author:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md dark:bg-gray-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"text",className:"block text-sm font-medium mb-1",children:"评论"}),e.jsx("textarea",{id:"text",value:a.text,onChange:t=>l({...a,text:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md h-32 dark:bg-gray-800",required:!0})]}),c&&e.jsx("div",{className:"text-sm py-2 px-3 rounded-md bg-blue-50 dark:bg-blue-900 text-blue-800 dark:text-blue-200",children:c}),e.jsx("button",{type:"submit",disabled:m,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:m?"提交中...":"发表评论"})]})]})}export{j as default};
