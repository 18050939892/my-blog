let f=[],d=0;const v=4;let h=e=>{let s=[],t={get(){return t.lc||t.listen(()=>{})(),t.value},lc:0,listen(l){return t.lc=s.push(l),()=>{for(let i=d+v;i<f.length;)f[i]===l?f.splice(i,v):i+=v;let n=s.indexOf(l);~n&&(s.splice(n,1),--t.lc||t.off())}},notify(l,n){let i=!f.length;for(let r of s)f.push(r,t.value,l,n);if(i){for(d=0;d<f.length;d+=v)f[d](f[d+1],f[d+2],f[d+3]);f.length=0}},off(){},set(l){let n=t.value;n!==l&&(t.value=l,t.notify(n))},subscribe(l){let n=t.listen(l);return l(t.value),n},value:e};return t};const w=5,a=6,c=10;let O=(e,s,t,l)=>(e.events=e.events||{},e.events[t+c]||(e.events[t+c]=l(n=>{e.events[t].reduceRight((i,r)=>(r(i),i),{shared:{},...n})})),e.events[t]=e.events[t]||[],e.events[t].push(s),()=>{let n=e.events[t],i=n.indexOf(s);n.splice(i,1),n.length||(delete e.events[t],e.events[t+c](),delete e.events[t+c])}),T=1e3,N=(e,s)=>O(e,l=>{let n=s(l);n&&e.events[a].push(n)},w,l=>{let n=e.listen;e.listen=(...r)=>(!e.lc&&!e.active&&(e.active=!0,l()),n(...r));let i=e.off;return e.events[a]=[],e.off=()=>{i(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let r of e.events[a])r();e.events[a]=[]}},T)},()=>{e.listen=n,e.off=i}}),L=e=>e,o={},g={addEventListener(){},removeEventListener(){}};function S(){try{return typeof localStorage<"u"}catch{return!1}}S()&&(o=localStorage);let U={addEventListener(e,s,t){window.addEventListener("storage",s),window.addEventListener("pageshow",t)},removeEventListener(e,s,t){window.removeEventListener("storage",s),window.removeEventListener("pageshow",t)}};typeof window<"u"&&(g=U);function x(e,s=void 0,t={}){let l=t.encode||L,n=t.decode||L,i=h(s),r=i.set;i.set=u=>{typeof u>"u"?delete o[e]:o[e]=l(u),r(u)};function p(u){u.key===e?u.newValue===null?r(void 0):r(n(u.newValue)):o[e]||r(void 0)}function E(){i.set(o[e]?n(o[e]):s)}return N(i,()=>{if(E(),t.listen!==!1)return g.addEventListener(e,p,E),()=>{g.removeEventListener(e,p,E)}}),i}const M=x("user:loggedIn",!1,{encode:JSON.stringify,decode:JSON.parse});export{M as c};
